#IML Cut Layout

Моделирование раскладки контуров высечки для In-mould-этикеток.

##Цели

1. Упростить процесс создания раскладки контуров. Пользователю не нужно разбираться в инструментарии `Adobe Illustrator`, чтобы сверстать необходимый файл для предварительного просчета стоимости заказа и заказа высекательного штампа.
2. Уменьшить (по возможности) количество облоя материала  за счет более эффективной раскладки контуров.

##Задача

* Необходимо разработать программу моделирования оптимальной раскладки контуров высечек на вал (боковую поверхность цилиндра) с учетом заданных условий и технологических  требований.

##Условия

* Печатная машина: MPS
* Минимальная ширина пореза материала: 230 мм (УТОЧНИТЬ!)
* Максимальная ширина пореза материала: 410 мм
* Для раскладки контуров можно использовать любые доступные валы для MPS (см. таблицу оснастки), кроме тех, где нет магнита. По умолчанию берется вал D=140.

##Требования

* Раскладка состоит из двух частей: области заполнения и контуров высечки.
* Область заполнения представляет замкнутый многоугольник (в простом случае - прямоугольник). При сворачивании формы области заполнения в цилиндр, верхняя и нижняя части должны без разрывов и наложений стыковаться друг с другом. 


* Область заполнения (ОЗ)

	* `ширина ОЗ` - это ширина пореза конкретного материала минус нерабочая область штампа (метка для MPS, две рельсы).

	* `длина ОЗ` - длина окружности конкретного вала (в случае прямоугольной ОЗ) или длина окружности конкретного вала плюс длина выступающих частей ОЗ (для ОЗ непрямоугольной формы).

	* `нерабочая область штампа` включает такие элементы, как рельсы и метка для MPS. Размер нерабочей области составляет 16÷20 мм.

* Контуры высечки (КВ)

	* В качестве контуров могут выступать как стандартные геометрические фигуры (прямоугольник, квадрат, круг, овал, n-угольник, звезда и т.д.), так и пользовательские фигуры сложной формы (колье, "банан", "сабля", крест, капля и т.п). В общем случае, контуры представляют собой замкнутые направленные многоугольники (выпуклые и невыпуклые), описанные либо векторами, либо сплайнами Безье. 

	* Частный случай: контур состоит из набора несвязанных векторов, которые предварительно необходимо собрать в направленный замкнутый многоугольник.

	* На одном высекательном штампе может размещаться `n` контуров одной геометрической формы.

* Способы раскладки контуров:

	* регулярная раскладка на основе прямоугольной или треугольной сетки для контуров небольшого размера

	* нерегулярная раскладка (со смещением и/или поворотом элементов) для контуров большого размера, не умещающихся по габаритам в прямоугольную область раскладки.

* Технологические требования к контурам:

	* отступ на вылет этикетки задается пользователем в диапазоне от 1,5 до 3 мм.
	* необходимо избегать появления длинных горизонтальных порезов. Процент горизонтального пореза (по координате X) может составлять не более 25-30% от ширины области заполнения.
	* Исключение (и/или уменьшение) горизонтальных порезов можно достичь за счет поворота контура или смещением контуров по оси Y ("разрядка")
	* контуры (с учетом отступа) не должны пересекаться друг с другом
	* предпочтительна регулярная раскладка с явным количеством ручьев (полос)
	* при регулярной раскладке нескольких контуров по вертикали ручьи могут входить в область друг друга не более чем на 15-20%
	* желательно полностью избегать наложения ручьев (можно добавить такую опцию в интерфейс).
	* при наложении ручьев нужно обязательно информировать пользователя о сложности собирания этикеток в стопки на Shober при данной раскладке. 

* Требования к области заполнения:

	* в случае непрямоугольной формы ОЗ, ее верхняя и нижняя часть представляют собой ломанную линию. Внешние углы между сегментами этой линии должны быть больше 90 и меньше 270 градусов. Это условие необходимо для корректного соединения ОЗ в цилиндр.
	* высота выступающей части ОЗ не должна превышать 30% (УТОЧНИТЬ!) от длины окружности вала.


* Необходимо предусмотреть сохранение различных вариантов раскладки для последующего сравнения и выбора оптимального варианта.

* Время работы алгоритма моделирования раскладок должно быть (по возможности) минимальным.

* Кроме раскладки контуров, программа должна формировать и выводить отчет по расходу материала для каждого варианта раскладки и углу поворота контура (-ов). Отчет может включать следующие данные:

	* количество необходимого материала (в метрах), исходя из тиражности заказа (количество этикеток)
	* количество облоя материала (в процентах и/или метрах)
	* угол поворота контуров раскладки (в градусах). В случае нерегулярной раскладки необходимо в отчете выводить информацию об угле поворота каждого отдельного контура.

* Необходимо разработать понятный и удобный интерфейс для решения основных задач пользователя:
	* предварительная раскладка контуров для просчета стоимости заказа (под разные порезы/валы)
	* окончательная раскладка (под конкретный порез/вал) для заказа высекательного штампа

##Реализация

* Программа `IML Cut Layout` может быть реализована как расширение (extension) для `Adobe Illustrator CC 2015`.

* В качестве входных данных (элементов пользовательского интерфейса) могут выступать следующие параметры:

	* тираж (шт.)
	* наименование материала
	* ширина пореза материала (мм)
	* диаметр вала (мм)
	* размер отступа на вылет этикетки (мм)

* Предусмотреть возможность пользователю программы добавлять новые материалы+порезы и редактировать уже имеющиеся.
