#IML Cut Layout

Моделирование раскладки контуров высечки для In-mould-этикеток.

##Цели

1. Упростить процесс создания раскладки контуров. Пользователю не нужно разбираться в инструментарии `Adobe Illustrator`, чтобы сверстать необходимый файл для предварительного просчета стоимости заказа и заказа высекательного штампа.
2. Уменьшить (по возможности) количество облоя материала  за счет более эффективной раскладки контуров.

##Задача

* Необходимо разработать программу моделирования оптимальной раскладки контуров высечек на вал (боковую поверхность цилиндра).

##Общие сведения

* IML-этикетки печатаются на двух машинах: MPS и RSC. Причем, на MPS могут печататься все типы IML-этикеток, а на RSC - только этикетки на прозрачном материале, где не используется водный лак.
* Для раскладки контуров можно использовать любые доступные валы для этих печатных машин (см. таблицу оснастки), кроме тех, где нет магнита. Желательно при формировании раскладки использовать общие для обеих машин диаметры валов (например, d=140).
* Необходимо учитавать, что максимальная ширина пореза для MPS=410 мм, для RSC=330 мм.

##Требования

* Форма высекательного штампа

	* В первом случае, форма штампа представляет правильный прямоугольник (Artboard в Adobe Illustrator), где ширина - это ширина пореза материала, а длина (высота) - длина окружности конкретного вала. В этом случае, нет необходимости специально рисовать прямоугольник, так как сам Artboard является им.

	* Во втором случае, форма штампа будет не прямоугольной, а фигурой сложной формы. Боковые грани формы штампа остаются прямыми вертикальными линиями, а верхняя и нижняя грани могут выходить за пределы Artboard и входить в его рабочую область. Главное, чтобы при сворачивании такой формы в цилиндр, верхняя и нижняя части полностью стыковались друг с другом. В этом случае, необходимо нарисовать этот контур и каким-нибудь образом выделить его, например цветом, и/или разместить его на отдельном слое. Кроме того, он должен быть замкнутым многоугольником.

* Нерабочая область штампа

	* Нужно учитывать, что на сборке помимо разложенных этикеток еще должны обязательно присутствовать такие элементы как рельсы, метка автоприводки, мишени и шкалки. Метка размером 8х5 мм располагается в левой части сборки, далее с отступом 1,5 мм (в обе стороны) проходит вертикальная рельса, шириной 2 мм. Такая же рельса располагается в правой части сборки. Шкалки располагаются либо справа от правой рельсы, либо в любом месте облоя. Мишени распологаются по углам сборки.

* Форма единичного контура высечки

* В качестве контуров могут выступать как стандартные геометрические фигуры (прямоугольник, квадрат, круг, овал, n-угольник, звезда и т.д.), так и пользовательские фигуры сложной формы (колье, "банан", "сабля", крест, капля и т.п). В общем случае, контуры представляют собой замкнутые направленные многоугольники (выпуклые и невыпуклые), описанные либо векторами, либо сплайнами Безье. Частный случай: контур состоит из набора несвязанных векторов, которые предварительно необходимо собрать в направленный замкнутый многоугольник.

* На одном высекательном штампе может размещаться `n` контуров одной геометрической формы.

* Способов раскладки тоже может быть несколько:
	* регулярная раскладка на основе прямоугольной или треугольной сетки для контуров небольшого размера
	* нерегулярная раскладка (со смещением и/или поворотом элементов) для контуров большого размера, не умещающихся по габаритам в прямоугольную область раскладки.

* Технологические требования к контурам:
	* отступ на вылет этикетки задается пользователем в диапазоне от 1,5 до 3 мм.
	* необходимо избегать появления длинных горизонтальных порезов. Процент горизонтального пореза (по координате X) может составлять не более 25-30% от ширины области заполнения. Исключение (и/или уменьшение) горизонтальных порезов можно достичь за счет поворота контура или смещением контуров по оси Y ("разрядка")
	* контуры (с учетом отступа) не должны пересекаться друг с другом
	* предпочтительна регулярная раскладка с явным количеством ручьев (полос)
	* при регулярной раскладке нескольких контуров по вертикали ручьи могут входить в область друг друга не более чем на 15-20%. Желательно полностью избегать наложения ручьев (можно добавить такую опцию в интерфейс).
	* при наложении ручьев нужно обязательно информировать пользователя о сложности собирания этикеток в стопки на Shober при такой раскладке. 

* Требования к области заполнения:
	* в форме области заполнения (верхняя и нижняя части) желательно не использовать острых углов и тонких вертикальных элементов, потому что металлическая форма высечки должна легко состыковываться на валу.

* Также необходимо предусмотреть сохранение различных вариантов раскладки для последующего сравнения и выбора оптимального варианта.

* Время работы алгоритма моделирования не должно превышать 30 секунд.

* Кроме непосредственной раскладки контуров, программа должна формировать и выводить отчет по расходу материала для каждого варианта раскладки и углу поворота контура (-ов). Отчет может включать следующие данные:
	* количество необходимого материала (в метрах), исходя из тиражности заказа (кол-во этикеток)
	* количество облоя материала (в процентах и/или метрах)
	* угол поворота контуров раскладки (в градусах). В случае нерегулярной раскладки необходимо в отчете выводить информацию о каждом угле поворота отдельного контура.

* В качестве входных данных могут выступать следующие параметры:
	* тираж (шт.)
	* ширина пореза материала (мм)
	* диаметр/длина вала (мм)
	* размер отступа на вылет (мм)

* Необходимо разработать понятный и удобный интерфейс для решения основных задач пользователя:
	* предварительная раскладка контуров для просчета стоимости заказа (под разные порезы/валы)
	* окончательная раскладка (под конкретный порез/вал) для заказа высекательного штампа

##Реализация

* Программа `IML Cut Layout` может быть реализована как расширение (extension) для `Adobe Illustrator CC 2015`.
